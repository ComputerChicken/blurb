<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Friends | Blurb</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" type="image/x-icon" href="/logo.png">
</head>
<body id="body">
    <div id="story-stuff">
        <select onchange="update()" id="story-type">
            <option value="pic" selected>Picture</option>
            <option value="vid">Video</option>
            <option value="txt">Text</option>
        </select>
        <div id="story-creator">
            <input type="file" id="story-input">
        </div>
        <button onclick="upload()">send it</button>
    </div>
</body>
<script>
    const port = 6767;

    function arraysEqual(a, b) {
        return a.length === b.length &&
            a.every((val, i) => val === b[i])
    }

    async function fetchData(url) {
        try {
            const response = await fetch(url);

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();

            return data;
        } catch (error) {
            console.error('Error fetching data:', error);
        }
    }

    async function getMyUserData() {
        return await fetchData("http://161.97.214.82:"+port+"/get-user-data?user="+username);
    }

    var username = localStorage["loggedUsername"];

    if(!username) {
        window.location = "signup.html"
    }
    
    var storyType = "file";

    function update() {
        if(["pic","vid"].includes(document.getElementById("story-type").value)) {
            document.getElementById("story-input").type = "file";
            storyType = "file";
            document.getElementById("story-input").style.padding = "0";
        } else {
            storyType = "text";
            document.getElementById("story-input").type = "text";
            document.getElementById("story-input").style.padding = "10px";
        }
    }

    async function upload() {
        var file;
        if(storyType == "text") {
            file = new File([document.getElementById("story-input").value], "example.txt", {
                type: "text/plain"
            });
        } else {
            file = document.getElementById("story-input").files[0];
        }

        const formData = new FormData();
        formData.append("username", username);
        formData.append("file", file);

        await fetch("http://161.97.214.82:"+port+"/upload", {
            method: 'POST',
            body: formData
        });

        window.location = "index.html";
    }
</script>
</html>